include: macros_output/for.def

subcode:: parsecode_func_other
    $elif $func eq "for"
        $call parsecode_for_support, c_style_protect
        return
    $elif $func eq "foreach"
        $if $param=~/(\w+)\s+in\s+(\w+)/
            my ($t, $v)=($1, $2)
            $call foreach_array
        $elif $param=~/^(\S+)\s*$/
            my ($t, $v)=("t", $1)
            $call foreach_array

#---------------------------------------- 
subcode: for_i0_i1_step
    $call for_i0_i1_step_default, loop_var

    subcode: loop_var
        $if $page->{_pageext} =~ /^(cpp|java)/
            $my="int "
            $if !$var
                $var = "i"
        $else
            $if !$var
                $var=temp_add_var("i", $type_name{i})
            $else
                $var=my_add_var($var, $type_name{i})
            protect_var($var)

subcode: for_c_style_protect
    $call push_single_block, "for($param){", "}"
    $(if:type!=asis)
        push @src, "PARSE:\$unprotect_var $var"

#---------------------------------------- 
subcode: foreach_array
    my $var=find_var($v)
    my $dim

    $if defined $var->{dimension}
        $dim=$var->{dimension}

    # print "foreach_array, $v, $var->{name}, $dim ...\n"

    $if defined $dim
        $call foreach_single, $dim
   
    subcode: foreach_single(range)
        my $type=pointer_type($var->{type})
        my $i=temp_add_var("i", $type_name{i})
        protect_var($i)
        MyDef::compileutil::set_current_macro("t", "$v\[$i\]")
        my $end="PARSE:\$unprotect_var $i"
        &call return_newblock, for
            $call push_single_block, "for($i=0;$i<$(range);$i++){", "}"
            push @src, $end

