include: c/lex.def
macros:
    input_use_end: 1

subcode: local_input(s)
    $local struct input_buffer local_input_buffer

    $local input
    input=&local_input_buffer
    input->buffer=(unsigned char*)$(s)
    input->n_pos=0
    $(if:input_use_end)
        $get_var_attr $(s), strlen
        $(if:!strlen)
            $(set:strlen=strlen($(s)))
        input->n_end=$(strlen)

#---------------------------------------- 
subcode: input_get_c(var)
    &call with_input
        # $call @assert, $(i)<$(e)
        $(var) = $(i)<$(e)?$(c):-1
        $(i)++

subcode: input_back_c
    $call @assert, input->n_pos>0
    input->n_pos--
